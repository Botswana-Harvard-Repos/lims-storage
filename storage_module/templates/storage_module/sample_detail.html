{% extends 'storage_module/base.html' %}
{% load storage_module_extras %}

{% block extra_script %}
    <script>
        $(document).ready(function () {
            $('.select2').select2();
        });
    </script>

    <style>
        .select2-container--default .select2-selection--single {
            width: 465px !important; /* Set the width to your preference */
        }
    </style>
{% endblock %}


{% block content %}
    <div class="container py-3">
        <div class="my-4">
            <h1>Sample Dashboard</h1>
            <ul class="list-group mt-3">
                <li class="list-group-item">
                    {% if box.location.facility %}
                        <i class="fas fa-warehouse"></i>
                        <a href="{% url 'facility_detail' box.location.facility.id %}">{{ box.location.facility.facility_name }}</a>
                    {% endif %}
                    {% if box.location.freezer %}
                        <ul class="list-group">
                        <li class="list-group-item">
                        <i class="fas fa-snowflake"></i>
                        <a href="{% url 'freezer_detail' box.location.freezer.id %}">{{ box.location.freezer.freezer_name }}</a>
                    {% endif %}
                    {% if box.location.shelf %}
                        <ul class="list-group">
                        <li class="list-group-item">
                        <i class="fas fa-layer-group"></i>
                        <a href="{% url 'shelf_detail' box.location.shelf.id %}">{{ box.location.shelf.shelf_name }}</a>
                    {% endif %}
                    {% if box.location.rack %}
                        <ul class="list-group">
                        <li class="list-group-item">
                        <i class="fas fa-box-open"></i>
                        <a href="{% url 'rack_detail' box.location.rack.id %}">{{ box.location.rack.rack_name }}</a>
                    {% endif %}
                    {% if box %}
                        <ul class="list-group">
                            <li class="list-group-item">
                                <i class="fas fa-cube"></i>
                                <a href="{% url 'box_detail' box.id %}">{{ box.box_name }}</a>
                                <ul class="list-group mt-2">
                                    <li class="list-group-item">
                                        <!-- Box Capacity for 10 x 10 grid -->
                                        <ul class="list-group mt-3">
                                            <h2>Box Positions:</h2>
                                            <table class="table mt-2">
                                                <thead>
                                                <tr>
                                                    <th scope="col">#</th>
                                                    {% for x in x_labels %}
                                                        <th scope="col">{{ x }}</th>
                                                    {% endfor %}
                                                </tr>
                                                </thead>
                                                <tbody>
                                                {% for y in y_labels %}
                                                    <tr>
                                                        <th scope="row">{{ y }}</th>
                                                        {% for x in x_labels %}
                                                            <td>
                                                                {% if sample_position.x_position == forloop.counter0 and sample_position.y_position == y %}
                                                                    <i class="fas fa-vial"></i>
                                                                {% endif %}
                                                            </td>
                                                        {% endfor %}
                                                    </tr>
                                                {% endfor %}
                                                </tbody>
                                            </table>
                                        </ul>
                                    </li>
                                </ul>
                            </li>
                        </ul>
                    {% else %}
                        <div class="alert alert-danger" role="alert">The sample is not in
                            storage.
                        </div>
                    {% endif %}
                    {% if box.location.rack %}
                        </li>
                        </ul>
                    {% endif %}
                    {% if box.location.shelf %}
                        </li>
                        </ul>
                    {% endif %}
                    {% if box.location.freezer %}
                        </li>
                        </ul>
                    {% endif %}
                </li>
            </ul>
        </div>

        <div class="card mb-4">
            <div class="card-body">
                <h2 class="card-title">{{ sample.sample_id }}'s Information</h2>

                <ul class="list-group list-group-flush">
                    <li class="list-group-item">
                        <strong>Type:</strong> {{ sample.sample_type.sample_type }}</li>
                    <li class="list-group-item"><strong>Source
                        File:</strong> {{ sample.source_file.source_file_name }}</li>
                    <li class="list-group-item">
                        <strong>Time:</strong> {{ sample.time.time_sampled }}</li>
                    <li class="list-group-item">
                        <strong>Status:</strong> <span
                            class="badge badge-secondary">{{ sample.sample_status.name }}</span>
                    </li>
                </ul>
            </div>
        </div>

        <div class="modal fade" id="moveSampleToBoxModal" tabindex="-1" role="dialog"
             aria-labelledby="moveSampleToBoxModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <form method="POST">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="moveSampleToBoxModalLabel">Move
                                Sample to Another Box</h5>
                            <button type="button" class="close" data-dismiss="modal"
                                    aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            {% csrf_token %}
                            <div class="form-group">
                                {{ move_sample_form.box.label_tag }}
                                {{ move_sample_form.box }}
                            </div>
                            <div class="form-group">
                                {{ move_sample_form.x_position.label_tag }}
                                {{ move_sample_form.x_position }}
                            </div>
                            <div class="form-group">
                                {{ move_sample_form.y_position.label_tag }}
                                {{ move_sample_form.y_position }}
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary"
                                    data-dismiss="modal">Close
                            </button>
                            <button type="submit" class="btn btn-primary">Move</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <div class="d-grid gap-2 d-md-flex justify-content-md-start mb-4">
            <button type="button" class="btn btn-success">Share</button>
            <button type="button" class="btn btn-warning">Export</button>
            <button type="button" class="btn btn-primary" data-toggle="modal"
                    data-target="#moveSampleToBoxModal">
                Move Sample
            </button>
        </div>

        <div class="card mb-3">
            <div class="card-body">
                <h2 class="card-title">Notes</h2>
                <form method="post">
                    {% csrf_token %}
                    <div class="mb-3">
                        <textarea class="form-control" name="note"
                                  placeholder="Add a note.."></textarea>
                    </div>
                    <input type="submit" class="btn btn-primary" value="Save Note">
                </form>

                {% for note in sample.notes.all %}
                    <div class="card mt-3">
                        <div class="card-body">
                            <h5 class="card-title">{{ note.author.username }}</h5>
                            <p class="card-subtitle text-muted">Posted
                                on {{ note.created_date }}</p>
                            <p class="card-text">{{ note.text }}</p>
                        </div>
                    </div>
                {% empty %}
                    <p>No notes yet.</p>
                {% endfor %}
            </div>
        </div>
    </div>
{% endblock %}